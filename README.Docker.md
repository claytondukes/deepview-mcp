# DeepView MCP Docker Setup

This document explains how to run DeepView MCP using Docker Compose for multi-project codebase analysis.

## Quick Start

1. **Copy the environment file:**

   ```bash
   cp .env.example .env
   ```

2. **Edit the `.env` file:**
   - Set your `GEMINI_API_KEY` (get it from <https://aistudio.google.com/>)
   - Adjust other settings as needed

3. **Create directories for volume mounts:**

   ```bash
   mkdir -p codebase logs data
   ```

4. **Add your codebase file:**
   Place your codebase file (`.txt` or `.md`) in the `codebase/` directory

5. **Start the service:**

   ```bash
   docker compose up
   ```

The service will be available at <http://localhost:8019>

## Configuration

All configuration is done via the `.env` file:

### Core Settings

- `GEMINI_API_KEY`: Your Google Gemini API key (required)
- `GEMINI_MODEL`: Gemini model to use (default: gemini-2.5-flash)

### Server Settings

- `MCP_PORT`: Port to serve on (default: 8019)
- `MCP_HOST`: Host to bind to (default: 0.0.0.0)
- `MCP_TRANSPORT`: Transport method (default: http)

### Volume Mounts

- `CODEBASE_PATH`: Local path for codebase files (default: ./codebase)
- `LOGS_PATH`: Local path for logs (default: ./logs)
- `DATA_PATH`: Local path for data storage (default: ./data)

### Docker Settings

- `CONTAINER_NAME`: Container name (default: deepview-mcp)
- `NETWORK_NAME`: Docker network name (default: deepview-mcp-network)

## Health Check

The service includes a health check endpoint at `/health` that returns:

```json
{
  "status": "healthy",
  "service": "DeepView MCP",
  "model": "gemini-2.5-flash",
  "transport": "http"
}
```

## Usage

Once running, you can interact with the DeepView MCP server in multiple ways:

### URL-Based Access (Recommended for Repomix)

For projects with `codebase.xml` files (generated by repomix):

```bash
# Access the sample project
curl "http://localhost:8019/sample?question=What%20does%20this%20code%20do?"

# Access your own projects
curl "http://localhost:8019/my-project?question=How%20is%20authentication%20handled?"

# Alternative /codebase/ prefix
curl "http://localhost:8019/codebase/sample?question=Explain%20the%20architecture"
```

**Project Structure:**

```text
codebase/
├── sample/
│   └── codebase.xml    # Sample project (included)
├── my-project/
│   └── codebase.xml    # Your project
└── another-project/
    └── codebase.xml    # Another project
```

### MCP Protocol Access

Use the MCP tools via the `/mcp` endpoint for programmatic access with tools like `deepview`, `list_codebase_files`, and `get_codebase_info`.

## Troubleshooting

1. **Container fails to start:**
   - Check that `GEMINI_API_KEY` is set in `.env`
   - Ensure the codebase directory exists and contains files

2. **Health check fails:**
   - Check container logs: `docker compose logs`
   - Verify the service is binding to the correct port

3. **Permission issues:**
   - Ensure the mounted directories have proper permissions
   - Check that the container can write to logs and data directories
